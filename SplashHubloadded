-- ====================================================================
-- Executor Hub: å…¨ã‚¨ãƒ©ãƒ¼å¯¾å¿œï¼†æ©Ÿèƒ½å®‰å®šåŒ–ç‰ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
-- âš ï¸ ä½¿ã„æ–¹: ä»¥ä¸‹ã® â˜…â˜…â˜…â˜…â˜… ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ã‚‹ 'false' ã‚’ 'true' ã«å¤‰æ›´ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
-- ====================================================================

task.wait(2)

-- Rayfieldã®èª­ã¿è¾¼ã¿ã‚’è©¦è¡Œ (èª­ã¿è¾¼ã‚ãªãã¦ã‚‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ç¶šè¡Œ)
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
if not Rayfield then
    warn("Rayfieldã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚UIã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€æ‰‹å‹•è¨­å®šã§ç¶šè¡Œã—ã¾ã™ã€‚")
end

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MAX_ZOOM_DISTANCE = 10000 
local DEFAULT_ZOOM_DISTANCE = 30 
local KILL_HEIGHT = -1000 
local GRAB_RANGE = 15 

-- â˜…â˜…â˜…â˜…â˜… ã“ã“ã‚’æ‰‹å‹•ã§ç·¨é›†ã—ã¦ãã ã•ã„ â˜…â˜…â˜…â˜…â˜…
local AntiGrabEnabled = true      -- æ´ã¿/æŠ•ã’ã‚‰ã‚ŒãŸã¨ãã®ã€å³è„±å‡º + ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«ã€‘ (false -> true ã§ ON)
local KiLLGrab = true             -- KiLL Grab (å·¦ã‚¯ãƒªãƒƒã‚¯æ´ã¿å³æ­») (false -> true ã§ ON)
local SpeedBoost = true           -- Speed Boost (false -> true ã§ ON)
local ToyInfEnabled = true        -- Toy Inf (ãŠã‚‚ã¡ã‚ƒç„¡é™è‡ªå‹•ç”Ÿæˆ) (false -> true ã§ ON)
local TargetToyID = 1              -- ç”Ÿæˆã—ãŸã„ãŠã‚‚ã¡ã‚ƒã®ID (1~10ã§èª¿æ•´)
local StopTrainEnabled = true     -- Stop Train (false -> true ã§ ON)
-- ãã®ä»–ã®æ©Ÿèƒ½
local WalkLegArmLock = true
local AutoAim = true
local SilentAim = true
local AntiSeaEnabled = true
local AllPartCoreEnabled = true
local AllPartToggle = true
-- â˜…â˜…â˜…â˜…â˜… ç·¨é›†ã¯ã“ã“ã¾ã§ â˜…â˜…â˜…â˜…â˜…

-- å†…éƒ¨å¤‰æ•°
local BASE_WALKSPEED = 16
local BOOST_WALKSPEED = 60
local forcedTeleportTarget = nil 
local ToyEvent = nil
local ToyCount = 0      
local StopTrainTask = nil
local KiLLGrabTask = nil -- KiLL Grabç”¨ã‚¿ã‚¹ã‚¯å¤‰æ•°

-- -------------------------
-- ğŸ”¹ ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
-- -------------------------
local function FindGrabbingPlayer(targetHRP)
    local grabber = nil
    local shortestDist = 10 
    
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local char = plr.Character
            local otherHRP = char and char:FindFirstChild("HumanoidRootPart")
            if otherHRP then
                local dist = (otherHRP.Position - targetHRP.Position).Magnitude
                if dist < shortestDist then
                    grabber = plr
                    shortestDist = dist
                end
            end
        end
    end
    return grabber
end

local function TeleportPlayer(plr)
    local char = plr.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if hrp then
        pcall(function()
            hrp.CFrame = CFrame.new(hrp.Position.X, KILL_HEIGHT, hrp.Position.Z)
            if Rayfield then Rayfield.Notify({Title = "Anti Grab", Content = "ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ç™ºå‹•: "..plr.Name.."ã‚’æµ·ã«ãƒ†ãƒ¬ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚", Duration = 3}) end
        end)
    end
end

-- Speed/WalkLockã®åˆ¶å¾¡ã‚’CharacterAddedã«é›†ç´„
LocalPlayer.CharacterAdded:Connect(function(char)
    local hum = char:WaitForChildOfClass("Humanoid", 5)
    if hum then
        if SpeedBoost then
            hum.WalkSpeed = BOOST_WALKSPEED
        else
            hum.WalkSpeed = BASE_WALKSPEED
        end
        if WalkLegArmLock then
            hum.WalkSpeed = 0
            hum.PlatformStand = true
        end
    end
end)

-- -------------------------
-- ğŸ’£ KiLL Grab ãƒ«ãƒ¼ãƒ— (ã‚¤ãƒ™ãƒ³ãƒˆéè² è·å¯¾ç­–)
-- -------------------------
local function startKiLLGrab()
    if KiLLGrabTask then task.cancel(KiLLGrabTask) end
    KiLLGrabTask = task.spawn(function()
        while KiLLGrab do
            local char = LocalPlayer.Character
            local hrp = char and char:FindFirstChild("HumanoidRootPart")
            if not char or not hrp then task.wait(0.1); goto continue end

            if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
                if not forcedTeleportTarget or not forcedTeleportTarget.Parent then
                    local target = GetClosestPlayer(GRAB_RANGE)
                    if target and target.Character then
                        forcedTeleportTarget = target.Character:FindFirstChild("HumanoidRootPart")
                        if forcedTeleportTarget then
                            pcall(function() forcedTeleportTarget.CFrame = CFrame.new(forcedTeleportTarget.Position.X, KILL_HEIGHT, forcedTeleportTarget.Position.Z) end)
                        end
                    end
                end
            else
                forcedTeleportTarget = nil
            end

            if forcedTeleportTarget and forcedTeleportTarget.Parent then
                pcall(function()
                    forcedTeleportTarget.CFrame = CFrame.new(
                        forcedTeleportTarget.Position.X, 
                        KILL_HEIGHT, 
                        forcedTeleportTarget.Position.Z
                    )
                end)
            end
            
            ::continue::
            task.wait(0.01) -- RenderStepped (æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ) ã‚ˆã‚Šã‚‚é…ãå®Ÿè¡Œ
        end
    end)
end

local function stopKiLLGrab()
    if KiLLGrabTask then task.cancel(KiLLGrabTask); KiLLGrabTask = nil end
    forcedTeleportTarget = nil
end

-- -------------------------
-- ğŸš‚ Stop Train ãƒ«ãƒ¼ãƒ— (RenderSteppedã‹ã‚‰åˆ†é›¢)
-- -------------------------
local function startStopTrain()
    if StopTrainTask then task.cancel(StopTrainTask) end
    StopTrainTask = task.spawn(function()
        while StopTrainEnabled do
            for _, part in pairs(Workspace:GetDescendants()) do
                if part:IsA("BasePart") and (part.Name:lower():match("train") or part.Name:lower():match("engine")) then
                    pcall(function() part.Anchored = true end)
                end
            end
            task.wait(0.5) -- ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›ã®ãŸã‚ã€0.5ç§’é–“éš”ã§ãƒã‚§ãƒƒã‚¯
        end
    end)
end

local function stopStopTrain()
    if StopTrainTask then task.cancel(StopTrainTask); StopTrainTask = nil end
end

-- -------------------------
-- ğŸ§¸ Toy Inf ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—)
-- -------------------------
local function getToyEvent()
    if not ToyEvent then
        ToyEvent = ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("CreateToy")
    end
    return ToyEvent
end
local toySpawnTask = nil
local function startToySpawn()
    local event = getToyEvent()
    if not event then
        if Rayfield then Rayfield.Notify({Title = "MOD", Content = "ãŠã‚‚ã¡ã‚ƒç”Ÿæˆã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", Duration = 5}) end
        return
    end
    ToyCount = 0
    toySpawnTask = task.spawn(function()
        while ToyInfEnabled do
            local cameraCFrame = Workspace.CurrentCamera.CFrame
            pcall(event.FireServer, event, TargetToyID, cameraCFrame.p, cameraCFrame.LookVector)
            ToyCount = ToyCount + 1
            if Rayfield and ToyCount == 1 then Rayfield.Notify({Title = "Toy Inf", Content = "ãŠã‚‚ã¡ã‚ƒã®è‡ªå‹•ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚", Duration = 3}) end
            task.wait(0.05) 
        end
    end)
end
local function stopToySpawn()
    if toySpawnTask then task.cancel(toySpawnTask); toySpawnTask = nil end
    if Rayfield then Rayfield.Notify({Title = "Toy Inf", Content = "ãŠã‚‚ã¡ã‚ƒã®ç”Ÿæˆã‚’åœæ­¢ã—ã¾ã—ãŸã€‚", Duration = 3}) end
    ToyCount = 0
end

-- -------------------------
-- â˜… Anti Grab å¼·åŒ–ãƒ­ã‚¸ãƒƒã‚¯ (ã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚pcallã‚’å¼·åŒ–)
-- -------------------------
local function ChappieAntiGrab(char)
    local hrp = pcall(char.WaitForChild, char, "HumanoidRootPart", 5) and char:FindFirstChild("HumanoidRootPart")
    local hum = pcall(char.WaitForChildOfClass, char, "Humanoid", 5) and char:FindFirstChildOfClass("Humanoid")
    
    if not hrp or not hum then return end
    
    local function Escape()
        if not AntiGrabEnabled and not KiLLGrab then return end
        task.defer(function()
            pcall(function()
                hum.PlatformStand = false; hum.Sit = false
                hrp.AssemblyLinearVelocity = Vector3.zero
                hrp.AssemblyAngularVelocity = Vector3.zero
                hrp.CFrame = hrp.CFrame + Vector3.new(0,0.4,0)
            end)
        end)
    end
    
    pcall(hrp.ChildAdded.Connect, hrp.ChildAdded, function(child)
        if not AntiGrabEnabled and not KiLLGrab then return end
        if child:IsA("Weld") or child:IsA("BodyMover") or child:IsA("BodyGyro") or child:IsA("BodyPosition") or child.Name:lower():match("grab") then
            Escape(); task.defer(function() pcall(child.Destroy, child) end)
        end
    end)
    
    pcall(hum.StateChanged.Connect, hum.StateChanged, function(_, new)
        if not AntiGrabEnabled then return end
        
        if new == Enum.HumanoidStateType.Ragdoll or new == Enum.HumanoidStateType.Physics or new == Enum.HumanoidStateType.PlatformStanding then
            Escape()
            
            if new == Enum.HumanoidStateType.Physics and hrp then -- nilãƒã‚§ãƒƒã‚¯å¼·åŒ–
                local grabber = FindGrabbingPlayer(hrp)
                if grabber then
                    TeleportPlayer(grabber)
                end
            end
        end
    end)
    
    pcall(char.DescendantAdded.Connect, char.DescendantAdded, function(d)
        if not AntiGrabEnabled and not KiLLGrab then return end
        if d:IsA("Weld") or d:IsA("Constraint") then
            Escape(); task.defer(function() pcall(d.Destroy, d) end)
        end
    end)
end

LocalPlayer.CharacterAdded:Connect(ChappieAntiGrab)
if LocalPlayer.Character then ChappieAntiGrab(LocalPlayer.Character) end

-- -------------------------
-- ğŸ”¹ RenderStepped ãƒ«ãƒ¼ãƒ— (ãƒ¡ã‚¤ãƒ³å‡¦ç†)
-- -------------------------
RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local camera = Workspace.CurrentCamera

    if not char or not hum or not hrp or not camera then return end

    -- 1. WalkLegArmLock/Speed Boostã®åˆ¶å¾¡ (CharacterAddedã®è£œåŠ©çš„ãªå‡¦ç†)
    if WalkLegArmLock then
        pcall(function()
            hum.WalkSpeed = 0; hum.PlatformStand = true; hum.HipHeight = 0.5 
        end)
    else
        if not SpeedBoost and hum.WalkSpeed ~= BASE_WALKSPEED then
            hum.WalkSpeed = BASE_WALKSPEED
        end
        hum.PlatformStand = false
    end
    
    -- 2. Anti Sea
    if AntiSeaEnabled and hrp.Position.Y < 0 then pcall(function() hrp.CFrame = hrp.CFrame + Vector3.new(0,0.5,0) end) end
    
    -- 3. Auto Aim (ã‚¤ãƒ™ãƒ³ãƒˆéè² è·å¯¾ç­–ã®ãŸã‚ã€RenderSteppedã§å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’ç°¡ç•¥åŒ–)
    if AutoAim then
        local target = GetClosestPlayer(10)
        if target and target.Character then
            local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
            if targetHRP then
                -- CFrameã‚’æ¯ãƒ•ãƒ¬ãƒ¼ãƒ æ›´æ–°ã™ã‚‹å‡¦ç†ã¯è² è·ãŒé«˜ã„ãŸã‚ã€å®Ÿè¡Œé »åº¦ã‚’èª¿æ•´ã™ã‚‹ã‹ã€RemoteEventã‚’ä½¿ã‚ãªã„Aimingæ–¹å¼ã‚’æ¤œè¨
                pcall(function() camera.CFrame = CFrame.new(camera.CFrame.Position, targetHRP.Position) end)
            end
        end
    end
    
    -- 4. All Part Core
    if AllPartCoreEnabled then
        for _, part in pairs(Workspace:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide == false and part.Name:lower() ~= "handle" then
                pcall(function() part.CanTouch = true end)
            end
        end
    end
end)

-- -------------------------
-- ğŸ”¹ åˆæœŸåŒ–å‡¦ç†
-- -------------------------
if ToyInfEnabled then startToySpawn() end
if StopTrainEnabled then startStopTrain() end
if KiLLGrab then startKiLLGrab() else stopKiLLGrab() end -- KiLLGrabã‚’ãƒ«ãƒ¼ãƒ—ã§èµ·å‹•

-- Speed Boostã®åˆæœŸè¨­å®š
if SpeedBoost and LocalPlayer.Character then
    local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum then hum.WalkSpeed = BOOST_WALKSPEED end
end

-- RayfieldãŒãƒ­ãƒ¼ãƒ‰ã§ããŸå ´åˆã€UIã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å„æ©Ÿèƒ½ã‚’æ¥ç¶š (ãƒˆã‚°ãƒ«ONæ™‚ã«ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹)
if Rayfield then
    -- ... (UIå®šç¾©ã®å„ã‚¿ãƒ–ã¯çœç•¥ã€‚UIãŒä½¿ãˆã‚‹å ´åˆã¯å‰å›ã®è¨­å®šãŒåæ˜ ã•ã‚Œã¾ã™ã€‚)

    local GrabTab = Window:CreateTab("Grab")
    GrabTab:CreateToggle({ 
        Name = "KiLL Grab (Grab & Instant Kill)", 
        CurrentValue = false, 
        Callback = function(v) 
            KiLLGrab = v
            if v then startKiLLGrab() else stopKiLLGrab() end -- UIãƒˆã‚°ãƒ«ã‹ã‚‰ãƒ«ãƒ¼ãƒ—ã‚’åˆ¶å¾¡
        end 
    })
    
    local MODTab = Window:CreateTab("MOD")
    MODTab:CreateToggle({ 
        Name = "Stop train (åˆ—è»Šåœæ­¢)", 
        CurrentValue = false, 
        Callback = function(v) 
            StopTrainEnabled = v
            if v then startStopTrain() else stopStopTrain() end -- UIãƒˆã‚°ãƒ«ã‹ã‚‰ãƒ«ãƒ¼ãƒ—ã‚’åˆ¶å¾¡
        end 
    })
    
    -- ... ä»–ã®UIå®šç¾© ...
end
