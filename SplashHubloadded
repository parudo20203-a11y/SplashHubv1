-- ====================================================================
-- SplashHub: V-GUI æœ€çµ‚å®‰å®šç‰ˆ (ã‚¨ãƒ©ãƒ¼å¯¾ç­–æ¸ˆã¿)
-- ====================================================================
local P = game:GetService("Players").LocalPlayer;
local UIS = game:GetService("UserInputService");
local RS = game:GetService("RunService");
local WS = game:GetService("Workspace");
local ReplicatedStorage = game:GetService("ReplicatedStorage");

local V_GUI_LOADER_URL = "https://raw.githubusercontent.com/vextroid/V-GUI/master/Loader.lua"
local V_GUI = loadstring(game:HttpGet(V_GUI_LOADER_URL))()

if not V_GUI then
    print("V-GUIã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã‚’ä¸­æ–­ã—ã¾ã™ã€‚")
    return
end

local WALK_SPEED = 32;
local FLY_SPEED = 40;
local MAX_FAILURES = 5;
local GRAB_DETECTION_OBJECTS = {"BodyPosition", "BodyVelocity", "BodyGyro", "AlignOrientation", "AlignPosition", "Attachment"};
local GRAB_EVENTS = {
    "GrabEvents.ExtendGrabLine", 
    "CharacterEvents.Look",
    "GrabEvents.GrabTarget",
    "GrabEvents.ReleaseGrab",
};

local remoteGrab = ReplicatedStorage:WaitForChild("GrabEvents", 5) and ReplicatedStorage.GrabEvents:WaitForChild("GrabTarget", 5);
local remoteRelease = ReplicatedStorage:WaitForChild("GrabEvents", 5) and ReplicatedStorage.GrabEvents:WaitForChild("ReleaseGrab", 5);

local isFlying = false;
local isLineExtending = false;
local currentLinePart = nil;
local bodyVelocity = nil;
local anticheatBinding = nil;
local flyLoopBinding = nil;
local antiragdollBinding = nil;
local grabDetectionConnection = nil;
local failureCount = 0;

-- ä¿®æ­£1: é€šçŸ¥ãƒ­ã‚¸ãƒƒã‚¯ã®å¼·åŒ–
local function showNotification(message, color)
    if not P.PlayerGui then return end
    
    local G = Instance.new("ScreenGui");
    if not pcall(function() G.Parent = P.PlayerGui end) then G:Destroy(); return end -- è¦ªè¨­å®šã®å¤±æ•—ã‚’ãƒã‚§ãƒƒã‚¯
    G.Name = "SplashHubNotify";

    local NF = Instance.new("Frame");
    local T = Instance.new("TextLabel");

    pcall(function()
        NF.Parent = G;
        NF.Size = UDim2.new(0, 300, 0, 50);
        NF.Position = UDim2.new(1, 0, 1, -50);
        NF.BackgroundColor3 = color or Color3.new(0.2, 0.2, 0.2);
        NF.BackgroundTransparency = 0.1;

        T.Parent = NF;
        T.Size = UDim2.new(1, 0, 1, 0);
        T.BackgroundTransparency = 1;
        T.Text = message;
        T.TextColor3 = Color3.fromRGB(255, 255, 255);
        T.Font = Enum.Font.SourceSansBold;
        T.TextSize = 18;
    end);

    pcall(NF.TweenPosition, NF, UDim2.new(1, -310, 1, -50), "Out", "Quart", 0.3, true);

    spawn(function()
        wait(3);
        pcall(NF.TweenPosition, NF, UDim2.new(1, 0, 1, -50), "In", "Quart", 0.3, true);
        wait(0.3);
        if G and G.Parent then pcall(G.Destroy, G) end;
    end);
end;

-- ä¿®æ­£2: ãƒ•ãƒƒã‚¯æˆåŠŸæ™‚ã®é€šçŸ¥ã‚’å‰Šé™¤ã—ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’è»½æ¸›
local function hookGrabEvents()
    for _, path in pairs(GRAB_EVENTS) do
        local parts = string.split(path, ".");
        local eventName = table.remove(parts);
        local current = ReplicatedStorage;

        for _, part in ipairs(parts) do
            current = current:WaitForChild(part, 3);
            if not current then break end
        end

        local event = current and current:FindFirstChild(eventName);

        if event and event:IsA("RemoteEvent") then
            pcall(function()
                -- ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ–ï¼ˆãƒ•ãƒƒã‚¯ï¼‰
                event.OnClientEvent:Connect(function() end);
            end)
            -- showNotificationã¯ã“ã“ã§å‰Šé™¤ã•ã‚Œã¾ã™
        end
    end
    showNotification("ğŸ”’ å…¨ã¦ã®é˜²å¾¡ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ•ãƒƒã‚¯ã—ã¾ã—ãŸã€‚", Color3.fromRGB(0, 255, 255));
end


-- Lineè·é›¢åˆ¶é™è§£é™¤æ©Ÿèƒ½ã®ãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—)
local function startLineExtension()
    if isLineExtending then return end;

    local Root = P.Character and P.Character:FindFirstChild("HumanoidRootPart");
    if not Root then showNotification("ã‚¨ãƒ©ãƒ¼: ãƒ©ã‚¤ãƒ³ã®èµ·ç‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", Color3.fromRGB(255, 0, 0)); return end;

    isLineExtending = true;
    showNotification("Lineæ‹¡å¼µ ON (ã‚¯ãƒªãƒƒã‚¯ã§æ´ã¿)", Color3.fromRGB(150, 255, 150));

    currentLinePart = Instance.new("Part");
    pcall(function()
        currentLinePart.Parent = WS;
        currentLinePart.Anchored = true;
        currentLinePart.CanCollide = false;
        currentLinePart.BrickColor = BrickColor.new("Really red");
        currentLinePart.Material = Enum.Material.ForceField;
        currentLinePart.Transparency = 0.5;
        currentLinePart.Name = "InfiniteGrabLine"
    end)

    RS:BindToRenderStep("LineExtension", Enum.RenderPriority.Camera.Value + 1, function()
        if not isLineExtending or not currentLinePart or not Root then return end;

        local mouseRay = WS.CurrentCamera:ScreenPointToRay(UIS:GetMouseLocation().X, UIS:GetMouseLocation().Y);
        local targetPos = mouseRay.Origin + mouseRay.Direction * 10000; 

        local startPos = Root.Position;
        local distance = (targetPos - startPos).Magnitude;

        pcall(function()
            currentLinePart.Size = Vector3.new(0.2, 0.2, distance);
            currentLinePart.CFrame = CFrame.new(startPos, targetPos) * CFrame.new(0, 0, -distance / 2);
        end)
    end)
end

local function stopLineExtension()
    if not isLineExtending then return end;

    isLineExtending = false;
    RS:UnbindFromRenderStep("LineExtension");

    if currentLinePart then
        pcall(currentLinePart.Destroy, currentLinePart);
        currentLinePart = nil;
    end

    showNotification("Lineæ‹¡å¼µ OFF", Color3.fromRGB(255, 150, 150));
end


-- â˜… å¼·åˆ¶æ´ã¿å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ (Lineæ©Ÿèƒ½ãŒONã®å ´åˆã®ã¿ä½œå‹•)
UIS.InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent or not isLineExtending or not remoteGrab or not remoteRelease then return end

    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        -- å·¦ã‚¯ãƒªãƒƒã‚¯: é è·é›¢ã§æ´ã¿ã‚¤ãƒ™ãƒ³ãƒˆã‚’å¼·åˆ¶å®Ÿè¡Œ
        local mouseRay = WS.CurrentCamera:ScreenPointToRay(UIS:GetMouseLocation().X, UIS:GetMouseLocation().Y);
        local forcedTargetPos = mouseRay.Origin + mouseRay.Direction * 5000; 
        
        pcall(remoteGrab.FireServer, remoteGrab, forcedTargetPos, forcedTargetPos);
        -- ã“ã®é€šçŸ¥ã‚‚é »ç¹ãªãŸã‚å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã„ãŒã€å‹•ä½œç¢ºèªã®ãŸã‚ç¶­æŒ
        showNotification("ğŸ’¥ é è·é›¢æ´ã¿ä¿¡å·ã‚’å¼·åˆ¶é€ä¿¡ï¼", Color3.fromRGB(255, 255, 0)); 

    elseif input.UserInputType == Enum.UserInputType.MouseButton2 then
        -- å³ã‚¯ãƒªãƒƒã‚¯: ãƒªãƒªãƒ¼ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚’å¼·åˆ¶å®Ÿè¡Œ
        pcall(remoteRelease.FireServer, remoteRelease);
        showNotification("ğŸ–ï¸ æ´ã¿ãƒªãƒªãƒ¼ã‚¹ä¿¡å·ã‚’å¼·åˆ¶é€ä¿¡ï¼", Color3.fromRGB(150, 150, 255));
    end
end)


-- æ´ã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ¤œçŸ¥ã¨ç ´å£Š (å¤‰æ›´ãªã—)
local function setupGrabDetection(rootPart)
    if grabDetectionConnection and grabDetectionConnection.Connected then grabDetectionConnection:Disconnect(); end
    grabDetectionConnection = rootPart.ChildAdded:Connect(function(child)
        for _, name in pairs(GRAB_DETECTION_OBJECTS) do
            if child.ClassName == name and child.Parent == rootPart then
                showNotification("â›” æ´ã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ¿å…¥æ¤œå‡ºï¼è„±å‡ºã‚’è©¦ã¿ã¾ã™ã€‚", Color3.fromRGB(255, 150, 0));
                pcall(child.Destroy, child);
            end
        end
    end);
end

-- æ•µã‚¹ã‚¯ãƒªãƒ—ãƒˆç„¡åŠ¹åŒ–æ©Ÿèƒ½ (å¤‰æ›´ãªã—)
local function disableTargetScript()
    local playerScripts = P:FindFirstChild("PlayerScripts");
    if not playerScripts then return end
    local targetScript = playerScripts:FindFirstChild("CharacterAndBeamMove");
    if targetScript then
        pcall(function() targetScript:Destroy(); end)
    end
end

-- é£›è¡Œæ©Ÿèƒ½ (å¤‰æ›´ãªã—)
local function stopFlying()
    if not isFlying then return end;
    isFlying = false; failureCount = 0;
    if anticheatBinding then pcall(RS.UnbindFromRenderStep, RS, "AntiAC"); anticheatBinding = nil end;
    local H = P.Character and P.Character:FindFirstChildOfClass("Humanoid");
    if H and H.Parent then pcall(function() H.WalkSpeed = WALK_SPEED end) end;
    if bodyVelocity and bodyVelocity.Parent then pcall(bodyVelocity.Destroy, bodyVelocity); bodyVelocity = nil end;
    showNotification("SplashHub: é£›è¡Œ OFF", Color3.fromRGB(255, 100, 100));
end;

local function startFlying()
    if isFlying then return end;
    local H = P.Character and P.Character:FindFirstChildOfClass("Humanoid");
    local Root = P.Character and P.Character:FindFirstChild("HumanoidRootPart");
    if not H or not Root or not Root.Parent then showNotification("ã‚¨ãƒ©ãƒ¼: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", Color3.fromRGB(255, 0, 0)); return end;
    isFlying = true;
    pcall(function() H.WalkSpeed = 0 end)
    if not bodyVelocity or not bodyVelocity.Parent then
        bodyVelocity = Root:FindFirstChildOfClass("BodyVelocity") or Instance.new("BodyVelocity");
        bodyVelocity.MaxForce = Vector3.new(1, 1, 1) * 9e9; bodyVelocity.P = 1000;
        pcall(function() bodyVelocity.Parent = Root end)
    end
    anticheatBinding = RS:BindToRenderStep("AntiAC", Enum.RenderPriority.Camera.Value, function()
        if not P.Character or not Root or not Root.Parent or not H or not H.Parent then stopFlying(); return end;
        if H.WalkSpeed ~= 0 then
            pcall(function() H.WalkSpeed = 0 end)
            if H.WalkSpeed ~= 0 then
                failureCount = failureCount + 1;
                if failureCount >= MAX_FAILURES then showNotification("ã‚¢ãƒ³ãƒãƒãƒ¼ãƒˆæ¤œå‡ºã€‚é£›è¡Œã‚’è§£é™¤ã—ã¾ã™ã€‚", Color3.fromRGB(255, 50, 50)); stopFlying(); return end
            end
        else failureCount = 0; end
        if bodyVelocity and not bodyVelocity.Parent then pcall(function() bodyVelocity.Parent = Root end); end;
    end);
    showNotification("SplashHub: é£›è¡Œ ON", Color3.fromRGB(100, 255, 100));
}

local function updateFlyMovement()
    if not isFlying or not P.Character or not P.Character:FindFirstChildOfClass("Humanoid") then stopFlying(); return end;
    if not bodyVelocity or not bodyVelocity.Parent then stopFlying(); return end;
    local C = WS.CurrentCamera; if not C then return end;
    local CF_ = C.CFrame; local mV = Vector3.new(0, 0, 0);
    if UIS:IsKeyDown(Enum.KeyCode.W) then mV = mV + CF_.LookVector end;
    if UIS:IsKeyDown(Enum.KeyCode.S) then mV = mV - CF_.LookVector end;
    if UIS:IsKeyDown(Enum.KeyCode.A) then mV = mV - CF_.RightVector end;
    if UIS:IsKeyDown(Enum.KeyCode.D) then mV = mV + CF_.RightVector end;
    if UIS:IsKeyDown(Enum.KeyCode.Space) then mV = mV + Vector3.new(0, 1, 0) end;
    if UIS:IsKeyDown(Enum.KeyCode.LeftShift) or UIS:IsKeyDown(Enum.KeyCode.RightShift) then mV = mV - Vector3.new(0, 1, 0) end;
    if mV.Magnitude > 0 then
        pcall(function() bodyVelocity.Velocity = mV.unit * FLY_SPEED end);
    else
        pcall(function() bodyVelocity.Velocity = Vector3.new(0, 0, 0) end);
    end;
end;

local function updateAntiRagdoll()
    local H = P.Character and P.Character:FindFirstChildOfClass("Humanoid");
    if H and H.Parent and H.PlatformStand == true then
         pcall(function() H.PlatformStand = false; end);
         showNotification("âš¡ PlatformStandã‚’å³åº§ã«è§£é™¤ã—ã¾ã—ãŸï¼", Color3.fromRGB(255, 255, 0));
    end
end;


-- UIæ§‹ç¯‰
local function createVGui()
    local Window = V_GUI:Window({
        title = "SplashHub V-GUI",
        icon = 4483862788,
        size = {400, 300},
        save = {
            enabled = true,
            path = "VGuiSplashHub"
        }
    })

    local MainTab = Window:Tab("Player & Flight")
    local ExploitTab = Window:Tab("Grab Bypass")

    -- Flight Section
    local FlightSection = MainTab:Section("Movement")
    FlightSection:Toggle("Infinite Flight", function(toggled)
        if toggled then
            startFlying()
        else
            stopFlying()
        end
    end)
    
    FlightSection:Slider("Fly Speed", 
    {
        min = 1, 
        max = 150, 
        value = FLY_SPEED, 
        callback = function(value) 
            FLY_SPEED = value 
        end
    })

    -- Grab Section
    local GrabSection = ExploitTab:Section("Line Exploitation")
    GrabSection:Toggle("Infinite Grab Distance", function(toggled)
        if toggled then
            startLineExtension()
        else
            stopLineExtension()
        end
    end)
    
    -- Anti-Detection Section
    local AntiCheatSection = MainTab:Section("Anti-Detection")
    AntiCheatSection:Toggle("Anti-Ragdoll (Auto-Clear)", function(toggled)
        -- ãƒ­ã‚¸ãƒƒã‚¯ã¯RenderStepã§å¸¸ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™
    end)
    
    -- åˆæœŸå€¤è¨­å®š
    Window:Change("Infinite Grab Distance", isLineExtending)
    Window:Change("Infinite Flight", isFlying)
end

-- åˆæœŸåŒ–é–¢æ•°
local function initialize()
    local function setupCharacter(character)
        local H = character:FindFirstChildOfClass("Humanoid");
        if H then pcall(function() H.WalkSpeed = WALK_SPEED end) end;
        if isFlying then stopFlying() end;
        local Root = character:FindFirstChild("HumanoidRootPart");
        if Root then setupGrabDetection(Root) end;
    end;
    if P.Character then setupCharacter(P.Character) end;
    P.CharacterAdded:Connect(setupCharacter);

    if not flyLoopBinding then flyLoopBinding = RS:BindToRenderStep("FlyMovement", Enum.RenderPriority.Character.Value, updateFlyMovement); end;
    if not antiragdollBinding then antiragdollBinding = RS:BindToRenderStep("AntiRagdoll", Enum.RenderPriority.Camera.Value - 1, updateAntiRagdoll); end;

    hookGrabEvents();
    disableTargetScript();
    
    -- V-GUI UIã®ä½œæˆ
    createVGui();
    showNotification("SplashHub V-GUI èµ·å‹•æˆåŠŸï¼", Color3.fromRGB(0, 255, 0));
end

pcall(initialize)
