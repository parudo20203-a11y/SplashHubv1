-- ====================================================================
-- Executor Hub: Rayfieldæ’ä¹…ã‚¨ãƒ©ãƒ¼å¯¾å¿œç‰ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ (æ‰‹å‹•æœ‰åŠ¹åŒ–ã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«æ©Ÿèƒ½ä»˜ã)
-- âš ï¸ ä½¿ã„æ–¹: ä»¥ä¸‹ã® â˜…â˜…â˜…â˜…â˜… ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ã‚‹ 'false' ã‚’ 'true' ã«å¤‰æ›´ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
-- ====================================================================

task.wait(2)

-- Rayfieldã®èª­ã¿è¾¼ã¿ã‚’è©¦è¡Œ (èª­ã¿è¾¼ã‚ãªãã¦ã‚‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ç¶šè¡Œ)
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
if not Rayfield then
    warn("Rayfieldã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚UIã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€æ‰‹å‹•è¨­å®šã§ç¶šè¡Œã—ã¾ã™ã€‚")
end

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MAX_ZOOM_DISTANCE = 10000 
local DEFAULT_ZOOM_DISTANCE = 30 
local KILL_HEIGHT = -1000 
local GRAB_RANGE = 15 

-- â˜…â˜…â˜…â˜…â˜… ã“ã“ã‚’æ‰‹å‹•ã§ç·¨é›†ã—ã¦ãã ã•ã„ â˜…â˜…â˜…â˜…â˜…
local AntiGrabEnabled = false      -- æ´ã¿/æŠ•ã’ã‚‰ã‚ŒãŸã¨ãã®ã€å³è„±å‡º + ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«ã€‘ (false -> true ã§ ON)
local KiLLGrab = false             -- KiLL Grab (å·¦ã‚¯ãƒªãƒƒã‚¯æ´ã¿å³æ­») (false -> true ã§ ON)
local SpeedBoost = false           -- Speed Boost (false -> true ã§ ON)
local ToyInfEnabled = false        -- Toy Inf (ãŠã‚‚ã¡ã‚ƒç„¡é™è‡ªå‹•ç”Ÿæˆ) (false -> true ã§ ON)
local TargetToyID = 1              -- ç”Ÿæˆã—ãŸã„ãŠã‚‚ã¡ã‚ƒã®ID (1~10ã§èª¿æ•´)
local StopTrainEnabled = false     -- Stop Train (false -> true ã§ ON)

-- ãã®ä»–ã®æ©Ÿèƒ½
local WalkLegArmLock = false
local AutoAim = false
local SilentAim = false
local AntiSeaEnabled = false
local AllPartCoreEnabled = false
local AllPartToggle = false
-- â˜…â˜…â˜…â˜…â˜… ç·¨é›†ã¯ã“ã“ã¾ã§ â˜…â˜…â˜…â˜…â˜…

-- å†…éƒ¨å¤‰æ•° (å¤‰æ›´ä¸è¦)
local BASE_WALKSPEED = 16
local BOOST_WALKSPEED = 60
local forcedTeleportTarget = nil 
local ToyEvent = nil
local ToyCount = 0      
local Angle = 0

-- -------------------------
-- ğŸ”¹ ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° (å¤‰æ›´ãªã—)
-- -------------------------
local function overrideCamera(enable)
    local camera = Workspace.CurrentCamera
    cameraOverrideActive = enable
    if camera then
        if enable then camera.MaxZoomDistance = MAX_ZOOM_DISTANCE; camera.MinZoomDistance = 0.5 
        else camera.MaxZoomDistance = DEFAULT_ZOOM_DISTANCE; camera.MinZoomDistance = 0.5 
        end
    end
end
local function setAllPartCore(enable) AllPartCoreEnabled = enable
    if Rayfield then Rayfield.Notify({Title = "MOD", Content = "ALL Part Core "..(enable and "ON" or "OFF"), Duration = 3}) end
end
local function causeServerLag()
    local remote = ReplicatedStorage:FindFirstChild("ServerRemoteEvent") or ReplicatedStorage:FindFirstChild("RemoteFunction")
    if remote then
        for i = 1, 100 do pcall(remote.FireServer, remote, string.rep("A", 1000)) end
    end
    if Rayfield then Rayfield.Notify({Title = "MOD", Content = "Lag 999999999 ä¿¡å·é€ä¿¡å®Œäº†ã€‚", Duration = 5}) end
end
local function setLowLag()
    if Rayfield then Rayfield.Notify({Title = "MOD", Content = "Low Lag: é«˜é€ŸåŒæœŸãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã—ã¾ã—ãŸã€‚", Duration = 5}) end
end
local function toggleStopTrain(enable)
    StopTrainEnabled = enable
    for _, part in pairs(Workspace:GetDescendants()) do
        if part.Name:lower():match("train") or part.Name:lower():match("engine") then
            pcall(function() part.Anchored = enable end)
        end
    end
    if Rayfield then Rayfield.Notify({Title = "MOD", Content = "Stop train "..(enable and "ON" or "OFF"), Duration = 3}) end
end
local function GetClosestPlayer(range)
    local closest, dist = nil, range
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = plr.Character.HumanoidRootPart
            local magnitude = (hrp.Position - Workspace.CurrentCamera.CFrame.Position).Magnitude
            if magnitude < dist then
                closest = plr
                dist = magnitude
            end
        end
    end
    return closest
end

-- -------------------------
-- ğŸ§¸ Toy Inf ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—)
-- -------------------------
local function getToyEvent()
    if not ToyEvent then
        ToyEvent = ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("CreateToy")
    end
    return ToyEvent
end
local toySpawnTask = nil
local function startToySpawn()
    local event = getToyEvent()
    if not event then
        if Rayfield then Rayfield.Notify({Title = "MOD", Content = "ãŠã‚‚ã¡ã‚ƒç”Ÿæˆã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", Duration = 5}) end
        return
    end
    ToyCount = 0
    toySpawnTask = task.spawn(function()
        while ToyInfEnabled do
            local cameraCFrame = Workspace.CurrentCamera.CFrame
            pcall(event.FireServer, event, TargetToyID, cameraCFrame.p, cameraCFrame.LookVector)
            ToyCount = ToyCount + 1
            if Rayfield and ToyCount == 1 then Rayfield.Notify({Title = "Toy Inf", Content = "ãŠã‚‚ã¡ã‚ƒã®è‡ªå‹•ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚", Duration = 3}) end
            task.wait(0.05) 
        end
    end)
end
local function stopToySpawn()
    if toySpawnTask then task.cancel(toySpawnTask); toySpawnTask = nil end
    if Rayfield then Rayfield.Notify({Title = "Toy Inf", Content = "ãŠã‚‚ã¡ã‚ƒã®ç”Ÿæˆã‚’åœæ­¢ã—ã¾ã—ãŸã€‚", Duration = 3}) end
    ToyCount = 0
end

-- -------------------------
-- â˜… Anti Grab å¼·åŒ–ãƒ­ã‚¸ãƒƒã‚¯ (è„±å‡º & ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«)
-- -------------------------
local function FindGrabbingPlayer(targetHRP)
    -- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ(è‡ªåˆ†)ã‚’æ´ã‚“ã§ã„ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã€HRPåŒå£«ã®è·é›¢ãŒ10æœªæº€ã®ç¯„å›²ã§æ¢ã™
    local grabber = nil
    local shortestDist = 10 
    
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local otherHRP = plr.Character.HumanoidRootPart
            local dist = (otherHRP.Position - targetHRP.Position).Magnitude
            if dist < shortestDist then
                grabber = plr
                shortestDist = dist
            end
        end
    end
    return grabber
end

local function TeleportPlayer(plr)
    local char = plr.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if hrp then
        -- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å¼·åˆ¶çš„ã«KILL_HEIGHTã¸ãƒ†ãƒ¬ãƒãƒ¼ãƒˆ
        hrp.CFrame = CFrame.new(hrp.Position.X, KILL_HEIGHT, hrp.Position.Z)
        if Rayfield then Rayfield.Notify({Title = "Anti Grab", Content = "ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ç™ºå‹•: "..plr.Name.."ã‚’æµ·ã«ãƒ†ãƒ¬ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚", Duration = 3}) end
    end
end

local function ChappieAntiGrab(char)
    local hrp = char:WaitForChild("HumanoidRootPart", 5)
    local hum = char:WaitForChildOfClass("Humanoid", 5)
    
    if not hrp or not hum then return end
    
    -- æ´ã¿ã‹ã‚‰ã®è„±å‡ºå‡¦ç†
    local function Escape()
        if not AntiGrabEnabled and not KiLLGrab then return end
        task.defer(function()
            hum.PlatformStand = false; hum.Sit = false
            hrp.AssemblyLinearVelocity = Vector3.zero
            hrp.AssemblyAngularVelocity = Vector3.zero
            hrp.CFrame = hrp.CFrame + Vector3.new(0,0.4,0) -- è»½ãä¸Šã«ç§»å‹•ã—ã¦æ‹˜æŸã‚’è§£é™¤
        end)
    end
    
    -- Weld/BodyMover/grab objectã®ç ´å£Š
    hrp.ChildAdded:Connect(function(child)
        if not AntiGrabEnabled and not KiLLGrab then return end
        if child:IsA("Weld") or child:IsA("BodyMover") or child:IsA("BodyGyro") or child:IsA("BodyPosition") or child.Name:lower():match("grab") then
            Escape(); task.defer(function() child:Destroy() end)
        end
    end)
    
    -- çŠ¶æ…‹å¤‰åŒ–ã‚’ç›£è¦–
    hum.StateChanged:Connect(function(_, new)
        if not AntiGrabEnabled then return end
        
        -- Ragdoll/Physics/PlatformStandingçŠ¶æ…‹ã«ãªã£ãŸã‚‰å³åº§ã«è„±å‡º
        if new == Enum.HumanoidStateType.Ragdoll or new == Enum.HumanoidStateType.Physics or new == Enum.HumanoidStateType.PlatformStanding then
            Escape()
            
            -- ã€æŠ•ã’ã‚‰ã‚ŒãŸæ™‚ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ”»æ’ƒã€‘: PhysicsçŠ¶æ…‹ï¼ˆæŠ•ã’ã‚‰ã‚Œä¸­ï¼‰ã‚’ç‹™ã†
            if new == Enum.HumanoidStateType.Physics then
                local grabber = FindGrabbingPlayer(hrp)
                if grabber then
                    TeleportPlayer(grabber) -- æŠ•ã’ãŸç›¸æ‰‹ã‚’ã‚­ãƒ«
                end
            end
        end
    end)
    
    -- Weld/Constraintã®ç ´å£Š
    char.DescendantAdded:Connect(function(d)
        if not AntiGrabEnabled and not KiLLGrab then return end
        if d:IsA("Weld") or d:IsA("Constraint") then
            Escape(); task.defer(function() d:Destroy() end)
        end
    end)
end

LocalPlayer.CharacterAdded:Connect(ChappieAntiGrab)
if LocalPlayer.Character then ChappieAntiGrab(LocalPlayer.Character) end

-- -------------------------
-- ğŸ”¹ UI å®šç¾© (RayfieldãŒèª­ã¿è¾¼ã‚ãŸã¨ãã®ãŸã‚ã«å®šç¾©ã¯ç¶­æŒ)
-- -------------------------
if Rayfield then
    local Window = Rayfield:CreateWindow({ Name = "Executor Hub", LoadingTitle = "Loading UIâ€¦", LoadingSubtitle = "Wait 2 secondsâ€¦", ConfigurationSaving = { Enabled = false } })
    
    -- (UIå®šç¾©ã®å„ã‚¿ãƒ–ã¯çœç•¥ã€‚UIãŒä½¿ãˆã‚‹å ´åˆã¯å‰å›ã®è¨­å®šãŒåæ˜ ã•ã‚Œã¾ã™ã€‚)

    local AntiTab = Window:CreateTab("Anti")
    AntiTab:CreateToggle({ 
        Name = "Anti Grab (å³è„±å‡º & ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«)", 
        CurrentValue = false, 
        Callback = function(v) AntiGrabEnabled = v end 
    })
    AntiTab:CreateToggle({ Name = "Anti Sea", CurrentValue = false, Callback = function(v) AntiSeaEnabled = v end })

    local GrabTab = Window:CreateTab("Grab")
    GrabTab:CreateToggle({ Name = "KiLL Grab (Grab & Instant Kill)", CurrentValue = false, Callback = function(v) KiLLGrab = v; if not v then forcedTeleportTarget = nil end end })

    -- ... ãã®ä»–ã®ã‚¿ãƒ–ã®UIå®šç¾©ã‚‚çœç•¥
end


-- -------------------------
-- ğŸ”¹ RenderStepped ãƒ«ãƒ¼ãƒ— (ãƒ¡ã‚¤ãƒ³å‡¦ç†)
-- -------------------------
RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local camera = Workspace.CurrentCamera

    if not char or not hum or not hrp or not camera then return end

    -- 1. WalkLegArmLock/Speed Boost
    if WalkLegArmLock then hum.WalkSpeed = 0; hum.PlatformStand = true; hum.HipHeight = 0.5 
    else
        if SpeedBoost then hum.WalkSpeed = BOOST_WALKSPEED
        elseif hum.WalkSpeed ~= BASE_WALKSPEED then hum.WalkSpeed = BASE_WALKSPEED end
        hum.PlatformStand = false
    end
    
    -- 2. Anti Sea
    if AntiSeaEnabled and hrp.Position.Y < 0 then hrp.CFrame = hrp.CFrame + Vector3.new(0,0.5,0) end
    
    -- 3. Auto Aim
    if AutoAim then
        local target = GetClosestPlayer(10)
        if target and target.Character:FindFirstChild("HumanoidRootPart") then
            local targetHRP = target.Character.HumanoidRootPart
            camera.CFrame = CFrame.new(camera.CFrame.Position, targetHRP.Position)
        end
    end
    
    -- 4. All Part Core
    if AllPartCoreEnabled then
        for _, part in pairs(Workspace:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide == false and part.Name:lower() ~= "handle" then
                pcall(function() part.CanTouch = true end)
            end
        end
    end
    
    -- 5. Stop Train (RenderSteppedå†…ã§ç¶™ç¶šçš„ã«Anchoredã‚’è¨­å®š)
    if StopTrainEnabled then
         for _, part in pairs(Workspace:GetDescendants()) do
            if part.Name:lower():match("train") or part.Name:lower():match("engine") then
                pcall(function() part.Anchored = true end)
            end
        end
    end

    -- 6. KiLL Grab (Grab & Instant Kill)
    if KiLLGrab then
        if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
            if not forcedTeleportTarget or not forcedTeleportTarget.Parent then
                local target = GetClosestPlayer(GRAB_RANGE)
                if target and target.Character then
                    forcedTeleportTarget = target.Character:FindFirstChild("HumanoidRootPart")
                    if forcedTeleportTarget then
                        forcedTeleportTarget.CFrame = CFrame.new(forcedTeleportTarget.Position.X, KILL_HEIGHT, forcedTeleportTarget.Position.Z)
                    end
                end
            end
        else
            forcedTeleportTarget = nil
        end

        if forcedTeleportTarget and forcedTeleportTarget.Parent then
            forcedTeleportTarget.CFrame = CFrame.new(
                forcedTeleportTarget.Position.X, 
                KILL_HEIGHT, 
                forcedTeleportTarget.Position.Z
            )
        end
    end
end)

-- -------------------------
-- ğŸ”¹ åˆæœŸåŒ–å‡¦ç† (Toy Infã®è‡ªå‹•é–‹å§‹)
-- -------------------------
if ToyInfEnabled then
    startToySpawn()
end
