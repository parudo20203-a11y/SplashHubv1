-- Rayfield 読み込み
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Splash Hub v1",
    LoadingTitle = "Splash Hub",
    LoadingSubtitle = "by pom,",
    ConfigurationSaving = {Enabled = true, FolderName = "MyAwesomeUI"}
})

local MainTab = Window:CreateTab("Player", 4483362458)

--===== Services & Player =====--
local player = game.Players.LocalPlayer
local cam = workspace.CurrentCamera
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

--===== Player Variables =====--
local char, hrp, hum
local function updateCharacter(c)
    char = c
    hrp = c:FindFirstChild("HumanoidRootPart") or c.PrimaryPart
    hum = c:FindFirstChild("Humanoid")
end
player.CharacterAdded:Connect(updateCharacter)
if player.Character then updateCharacter(player.Character) end

--===== Fly =====--
local flying = false
local FlySpeed = 50
local moveKeys = {W=false, A=false, S=false, D=false, Space=false, Shift=false}

UIS.InputBegan:Connect(function(input, gp)
    if gp then return end
    local k = input.KeyCode
    if k == Enum.KeyCode.W then moveKeys.W = true end
    if k == Enum.KeyCode.A then moveKeys.A = true end
    if k == Enum.KeyCode.S then moveKeys.S = true end
    if k == Enum.KeyCode.D then moveKeys.D = true end
    if k == Enum.KeyCode.Space then moveKeys.Space = true end
    if k == Enum.KeyCode.LeftShift then moveKeys.Shift = true end
end)

UIS.InputEnded:Connect(function(input, gp)
    if gp then return end
    local k = input.KeyCode
    if k == Enum.KeyCode.W then moveKeys.W = false end
    if k == Enum.KeyCode.A then moveKeys.A = false end
    if k == Enum.KeyCode.S then moveKeys.S = false end
    if k == Enum.KeyCode.D then moveKeys.D = false end
    if k == Enum.KeyCode.Space then moveKeys.Space = false end
    if k == Enum.KeyCode.LeftShift then moveKeys.Shift = false end
end)

RunService.RenderStepped:Connect(function()
    if flying and hrp then
        local dir = Vector3.zero
        local cf = cam.CFrame
        if moveKeys.W then dir += cf.LookVector end
        if moveKeys.S then dir -= cf.LookVector end
        if moveKeys.A then dir -= cf.RightVector end
        if moveKeys.D then dir += cf.RightVector end
        if moveKeys.Space then dir += Vector3.yAxis end
        if moveKeys.Shift then dir -= Vector3.yAxis end
        if dir.Magnitude > 0 then
            hrp.Velocity = dir.Unit * FlySpeed
        else
            hrp.Velocity = Vector3.zero
        end
    end
end)

--===== Noclip =====--
local noclip = false
RunService.Stepped:Connect(function()
    if noclip and char then
        for _, v in pairs(char:GetDescendants()) do
            if v:IsA("BasePart") then
                v.CanCollide = false
            end
        end
    end
end)

--===== Infinity Jump =====--
local infinityJump = false
UIS.JumpRequest:Connect(function()
    if infinityJump and hum then
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

--===== WalkLegArmLock =====--
local walkLock = false
RunService.RenderStepped:Connect(function()
    if walkLock and hum then
        for _, track in pairs(hum:GetPlayingAnimationTracks()) do
            track:Stop()
        end
    end
end)

--===== SpeedBoost =====--
local speedBoost = false
local normalWalkSpeed = 16
local boostAmount = 10
RunService.RenderStepped:Connect(function()
    if hum then
        hum.WalkSpeed = speedBoost and normalWalkSpeed + boostAmount or normalWalkSpeed
    end
end)

--===== Camera FOV & MaxZoomCamera =====--
local currentFOV = 70
local maxZoomEnabled = false
cam.FieldOfView = currentFOV

MainTab:CreateSlider({
    Name="FOV",
    Range={70,200},
    Increment=1,
    CurrentValue=currentFOV,
    Callback=function(v)
        currentFOV = v
    end
})

RunService.RenderStepped:Connect(function()
    if cam then
        cam.FieldOfView = currentFOV
        if maxZoomEnabled then
            cam.CameraType = Enum.CameraType.Custom
        end
    end
end)

--===== ESP =====--
local espEnabled = false
local espBoxes = {}
local function getPrimaryPart(c)
    return c:FindFirstChild("HumanoidRootPart") or c.PrimaryPart
end

local function createESP(target)
    if espBoxes[target] then return end
    local box = Drawing.new("Square")
    box.Color = Color3.new(1,0,0)
    box.Thickness = 2
    box.Transparency = 1
    box.Visible = false
    box.Filled = false
    espBoxes[target] = box
end

RunService.RenderStepped:Connect(function()
    if espEnabled then
        for _, p in pairs(game.Players:GetPlayers()) do
            if p ~= player and p.Character and getPrimaryPart(p.Character) then
                createESP(p)
                local part = getPrimaryPart(p.Character)
                local pos, onScreen = cam:WorldToViewportPoint(part.Position)
                local box = espBoxes[p]
                if onScreen then
                    box.Position = Vector2.new(pos.X-10,pos.Y-10)
                    box.Size = Vector2.new(20,20)
                    box.Visible = true
                else
                    box.Visible = false
                end
            end
        end
    else
        for _, box in pairs(espBoxes) do
            box.Visible = false
        end
    end
end)

--===== AutoAim =====--
local autoAim = false
local autoAimActive = false
local aimRadius = 10

MainTab:CreateToggle({
    Name="AutoAim（ON/OFF）",
    CurrentValue=false,
    Callback=function(v)
        autoAim = v
        autoAimActive = v
    end
})

UIS.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.R then
        autoAim = not autoAim
        autoAimActive = autoAim
    end
end)

local function getClosestPlayer()
    local closestDist = math.huge
    local closestPlayer = nil
    if not hrp then return nil end
    for _, p in pairs(game.Players:GetPlayers()) do
        if p ~= player and p.Character and getPrimaryPart(p.Character) then
            local dist = (getPrimaryPart(p.Character).Position - hrp.Position).Magnitude
            if dist < closestDist and dist <= aimRadius then
                closestDist = dist
                closestPlayer = p
            end
        end
    end
    return closestPlayer
end

RunService.RenderStepped:Connect(function()
    if autoAimActive and hrp and cam then
        local target = getClosestPlayer()
        if target then
            local targetPos = getPrimaryPart(target.Character).Position
            local direction = (targetPos - cam.CFrame.Position).Unit
            cam.CFrame = CFrame.new(cam.CFrame.Position, cam.CFrame.Position + direction)
            local tool = player.Character and player.Character:FindFirstChildOfClass("Tool")
            if tool and tool:FindFirstChild("Activate") then
                tool:Activate()
                autoAimActive = false
                autoAim = false
            end
        end
    end
end)

--===== Rayfield UI =====--
MainTab:CreateToggle({Name="Fly（ON/OFF）", CurrentValue=false, Callback=function(v) flying=v end})
MainTab:CreateSlider({Name="Fly Speed", Range={10,200}, Increment=1, CurrentValue=FlySpeed, Callback=function(v) FlySpeed=v end})
MainTab:CreateToggle({Name="Noclip（壁抜け ON/OFF）", CurrentValue=false, Callback=function(v) noclip=v end})
MainTab:CreateToggle({Name="Infinity Jump（無限ジャンプ ON/OFF）", CurrentValue=false, Callback=function(v) infinityJump=v end})
MainTab:CreateToggle({Name="ESP（ON/OFF）", CurrentValue=false, Callback=function(v) espEnabled=v end})
MainTab:CreateToggle({Name="MaxZoomCamera（ON/OFF）", CurrentValue=false, Callback=function(v) maxZoomEnabled=v end})
MainTab:CreateToggle({Name="WalkLegArmLock（ON/OFF）", CurrentValue=false, Callback=function(v) walkLock=v end})
MainTab:CreateToggle({Name="SpeedBoost（ON/OFF）", CurrentValue=false, Callback=function(v) speedBoost=v end})
