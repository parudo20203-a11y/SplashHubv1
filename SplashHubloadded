-- ====================================================================
-- Executor Hub: Anti Grab å¼·åŒ–ç‰ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ (ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«æ©Ÿèƒ½è¿½åŠ )
-- ====================================================================

task.wait(2)

local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

if not Rayfield then
    warn("Rayfieldã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚UIã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å˜ä½“æ©Ÿèƒ½ã¨ã—ã¦ç¶šè¡Œã—ã¾ã™ã€‚")
end

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local MAX_ZOOM_DISTANCE = 10000 
local DEFAULT_ZOOM_DISTANCE = 30 
local KILL_HEIGHT = -1000 
local GRAB_RANGE = 15 

-- å®šæ•°ã¨åˆæœŸåŒ–å¤‰æ•°
local BASE_WALKSPEED = 16
local BOOST_WALKSPEED = 60
local GRAB_EVENTS = {
    "GrabEvents.ExtendGrabLine", "CharacterEvents.Look",
    "GrabEvents.GrabTarget", "GrabEvents.ReleaseGrab",
}
local SpeedBoost = false
local WalkLegArmLock = false
local AutoAim = false
local SilentAim = false
local CloudColorToggle = false
local AllPartToggle = false
local allPartsColor = Color3.fromRGB(255,255,255)
local AntiGrabEnabled = false        -- â˜… ä»Šå›ä¿®æ­£å¯¾è±¡
local AntiSeaEnabled = false
local KiLLGrab = false           
local AllPartCoreEnabled = false 
local StopTrainEnabled = false     
local forcedTeleportTarget = nil 
local ToyInfEnabled = false        

-- Toy Inf å¤‰æ•°
local ToyEvent = nil
local TargetToyID = 1 
local ToyCount = 0      
local MAX_TOY_FOR_EFFECT = 50 
local Angle = 0

-- -------------------------
-- ğŸ”¹ ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° (GetClosestPlayer, Notifiyãªã©) - å¤‰æ›´ãªã—
-- -------------------------
local function overrideCamera(enable)
    local camera = Workspace.CurrentCamera
    cameraOverrideActive = enable
    if camera then
        if enable then camera.MaxZoomDistance = MAX_ZOOM_DISTANCE; camera.MinZoomDistance = 0.5 
        else camera.MaxZoomDistance = DEFAULT_ZOOM_DISTANCE; camera.MinZoomDistance = 0.5 
        end
    end
end
local function setAllPartCore(enable) AllPartCoreEnabled = enable
    if Rayfield then Rayfield.Notify({Title = "MOD", Content = "ALL Part Core "..(enable and "ON" or "OFF"), Duration = 3}) end
end
local function causeServerLag()
    local remote = ReplicatedStorage:FindFirstChild("ServerRemoteEvent") or ReplicatedStorage:FindFirstChild("RemoteFunction")
    if remote then
        for i = 1, 100 do pcall(remote.FireServer, remote, string.rep("A", 1000)) end
    end
    if Rayfield then Rayfield.Notify({Title = "MOD", Content = "Lag 999999999 ä¿¡å·é€ä¿¡å®Œäº†ã€‚", Duration = 5}) end
end
local function setLowLag()
    if Rayfield then Rayfield.Notify({Title = "MOD", Content = "Low Lag: é«˜é€ŸåŒæœŸãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã—ã¾ã—ãŸã€‚", Duration = 5}) end
end
local function toggleStopTrain(enable)
    StopTrainEnabled = enable
    for _, part in pairs(Workspace:GetDescendants()) do
        if part.Name:lower():match("train") or part.Name:lower():match("engine") then
            pcall(function() part.Anchored = enable end)
        end
    end
    if Rayfield then Rayfield.Notify({Title = "MOD", Content = "Stop train "..(enable and "ON" or "OFF"), Duration = 3}) end
end
local function GetClosestPlayer(range)
    local closest, dist = nil, range
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = plr.Character.HumanoidRootPart
            local magnitude = (hrp.Position - Workspace.CurrentCamera.CFrame.Position).Magnitude
            if magnitude < dist then
                closest = plr
                dist = magnitude
            end
        end
    end
    return closest
end

-- -------------------------
-- ğŸ§¸ Toy Inf ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—)
-- -------------------------
local function getToyEvent()
    if not ToyEvent then
        ToyEvent = ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("CreateToy")
    end
    return ToyEvent
end
local toySpawnTask = nil
local function startToySpawn()
    local event = getToyEvent()
    if not event then
        if Rayfield then Rayfield.Notify({Title = "MOD", Content = "ãŠã‚‚ã¡ã‚ƒç”Ÿæˆã‚¤ãƒ™ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚", Duration = 5}) end
        return
    end
    ToyCount = 0
    toySpawnTask = task.spawn(function()
        while ToyInfEnabled do
            local cameraCFrame = Workspace.CurrentCamera.CFrame
            pcall(event.FireServer, event, TargetToyID, cameraCFrame.p, cameraCFrame.LookVector)
            ToyCount = ToyCount + 1
            if Rayfield and ToyCount == 1 then Rayfield.Notify({Title = "Toy Inf", Content = "ãŠã‚‚ã¡ã‚ƒã®è‡ªå‹•ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚", Duration = 3}) end
            task.wait(0.05) 
        end
    end)
end
local function stopToySpawn()
    if toySpawnTask then task.cancel(toySpawnTask); toySpawnTask = nil end
    if Rayfield then Rayfield.Notify({Title = "Toy Inf", Content = "ãŠã‚‚ã¡ã‚ƒã®ç”Ÿæˆã‚’åœæ­¢ã—ã¾ã—ãŸã€‚", Duration = 3}) end
    ToyCount = 0
end

-- -------------------------
-- â˜… Anti Grab å¼·åŒ–ãƒ­ã‚¸ãƒƒã‚¯
-- -------------------------
local function FindGrabbingPlayer(targetHRP)
    -- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ(è‡ªåˆ†)ã‚’æ´ã‚“ã§ã„ã‚‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã€ä¸€å®šã®ç¯„å›²å†…ã§æ¢ã™ã€‚
    -- Fling Thingsã§ã¯ã€Grab LineãŒæ´ã¿æ‰‹ã¨HRPã®é–“ã«å­˜åœ¨ã™ã‚‹ã€‚
    -- ã¾ãŸã¯ã€Grabã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ã£ãŸç›´è¿‘ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¢ã™ã€‚
    
    local grabber = nil
    local shortestDist = 10 -- æ´ã‚€å‹•ä½œã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŒã¤ã¹ãæœ€å°è·é›¢
    
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local otherHRP = plr.Character.HumanoidRootPart
            local dist = (otherHRP.Position - targetHRP.Position).Magnitude
            
            -- HRPåŒå£«ã®è·é›¢ãŒè¿‘ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ´ã¿æ‰‹ã¨ä»®å®š (æ´ã‚“ã§ã„ã‚‹ã¨ãã¯è·é›¢ãŒè¿‘ããªã‚‹ãŸã‚)
            if dist < shortestDist then
                grabber = plr
                shortestDist = dist
            end
        end
    end
    
    return grabber
end

local function TeleportPlayer(plr)
    local char = plr.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if hrp then
        -- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å¼·åˆ¶çš„ã«KILL_HEIGHTã¸ãƒ†ãƒ¬ãƒãƒ¼ãƒˆ
        hrp.CFrame = CFrame.new(hrp.Position.X, KILL_HEIGHT, hrp.Position.Z)
        if Rayfield then Rayfield.Notify({Title = "Anti Grab", Content = "ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ç™ºå‹•: "..plr.Name.."ã‚’æµ·ã«ãƒ†ãƒ¬ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚", Duration = 3}) end
    end
end

-- -------------------------
-- â˜… Chappie Anti Grab ä¿®æ­£ç‰ˆ (ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ )
-- -------------------------
local function ChappieAntiGrab(char)
    local hrp = char:WaitForChild("HumanoidRootPart", 5)
    local hum = char:WaitForChildOfClass("Humanoid", 5)
    
    if not hrp or not hum then return end
    
    -- è„±å‡ºãƒ­ã‚¸ãƒƒã‚¯
    local function Escape()
        if not AntiGrabEnabled and not KiLLGrab then return end
        task.defer(function()
            hum.PlatformStand = false; hum.Sit = false
            hrp.AssemblyLinearVelocity = Vector3.zero
            hrp.AssemblyAngularVelocity = Vector3.zero
            hrp.CFrame = hrp.CFrame + Vector3.new(0,0.4,0)
        end)
    end
    
    -- ChildAdded (Weld/BodyMover/BodyGyro/BodyPosition/grab object)
    hrp.ChildAdded:Connect(function(child)
        if not AntiGrabEnabled and not KiLLGrab then return end
        if child:IsA("Weld") or child:IsA("BodyMover") or child:IsA("BodyGyro") or child:IsA("BodyPosition") or child.Name:lower():match("grab") then
            Escape(); task.defer(function() child:Destroy() end)
        end
    end)
    
    -- StateChanged (æŠ•ã’ã‚‰ã‚ŒãŸã¨ãã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ”»æ’ƒ)
    hum.StateChanged:Connect(function(_, new)
        if not AntiGrabEnabled then return end
        
        -- Ragdoll/Physics/PlatformStandingçŠ¶æ…‹ã«ãªã£ãŸã‚‰å³åº§ã«è„±å‡º
        if new == Enum.HumanoidStateType.Ragdoll or new == Enum.HumanoidStateType.Physics or new == Enum.HumanoidStateType.PlatformStanding then
            Escape()
            
            -- ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ”»æ’ƒãƒ­ã‚¸ãƒƒã‚¯: æŠ•ã’ã‚‰ã‚ŒãŸç›´å¾Œã‚’ç‹™ã†
            if new == Enum.HumanoidStateType.Physics then
                -- æŠ•ã’ã‚‰ã‚ŒãŸæ™‚ã«æœ€ã‚‚è¿‘ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¢ã™
                local grabber = FindGrabbingPlayer(hrp)
                if grabber then
                    -- ç›¸æ‰‹ã‚’ãƒ†ãƒ¬ãƒãƒ¼ãƒˆã•ã›ã¦ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«
                    TeleportPlayer(grabber)
                end
            end
        end
    end)
    
    -- DescendantAdded (Weld/Constraint)
    char.DescendantAdded:Connect(function(d)
        if not AntiGrabEnabled and not KiLLGrab then return end
        if d:IsA("Weld") or d:IsA("Constraint") then
            Escape(); task.defer(function() d:Destroy() end)
        end
    end)
end

LocalPlayer.CharacterAdded:Connect(ChappieAntiGrab)
if LocalPlayer.Character then ChappieAntiGrab(LocalPlayer.Character) end


-- -------------------------
-- ğŸ”¹ UI å®šç¾© (RayfieldãŒèª­ã¿è¾¼ã‚ãŸã¨ãã®ãŸã‚ã«å®šç¾©ã¯ç¶­æŒ)
-- -------------------------
if Rayfield then
    local Window = Rayfield:CreateWindow({ Name = "Executor Hub", LoadingTitle = "Loading UIâ€¦", LoadingSubtitle = "Wait 2 secondsâ€¦", ConfigurationSaving = { Enabled = false } })
    -- ... (Player, Visual, FOVã‚¿ãƒ–ã®å®šç¾©ã¯çœç•¥) ...

    local AntiTab = Window:CreateTab("Anti")
    AntiTab:CreateToggle({ 
        Name = "Anti Grab (å³è„±å‡º & ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ«)", 
        CurrentValue = false, 
        Callback = function(v) 
            AntiGrabEnabled = v 
            if Rayfield then Rayfield.Notify({Title = "Anti Grab", Content = "ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚­ãƒ« ".. (v and "ON" or "OFF"), Duration = 3}) end
        end 
    })
    AntiTab:CreateToggle({ Name = "Anti Sea", CurrentValue = false, Callback = function(v) AntiSeaEnabled = v end })

    local GrabTab = Window:CreateTab("Grab")
    GrabTab:CreateToggle({ Name = "KiLL Grab (Grab & Instant Kill)", CurrentValue = false, Callback = function(v) KiLLGrab = v; if not v then forcedTeleportTarget = nil end end })

    local MODTab = Window:CreateTab("MOD")
    MODTab:CreateSection("Physics & Touch")
    MODTab:CreateToggle({ Name = "ALL Part Core (å…¨Partåˆ¤å®š)", CurrentValue = false, Callback = setAllPartCore })
    MODTab:CreateToggle({ Name = "Toy Inf (è‡ªå‹•ç”Ÿæˆ & ç¾½)", CurrentValue = false, Callback = function(v) ToyInfEnabled = v; if v then startToySpawn() else stopToySpawn() end end }) 
    MODTab:CreateSlider({ Name = "Target Toy ID", Range = {1, 10}, Increment = 1, Suffix = "ID", CurrentValue = TargetToyID, Callback = function(v) TargetToyID = v; if Rayfield then Rayfield.Notify({Title = "Toy Inf", Content = "Target Toy IDã‚’ "..v.." ã«è¨­å®šã—ã¾ã—ãŸã€‚", Duration = 2}) end end })
    MODTab:CreateSection("Network & Lag")
    MODTab:CreateButton({ Name = "Lag 999999999 (ã‚µãƒ¼ãƒãƒ¼ãƒ©ã‚°)", Callback = causeServerLag })
    MODTab:CreateButton({ Name = "Low Lag (Ping 1mså›ºå®š)", Callback = setLowLag })
    MODTab:CreateSection("Game Specific (Fling Things)")
    MODTab:CreateToggle({ Name = "Stop train (åˆ—è»Šåœæ­¢)", CurrentValue = false, Callback = toggleStopTrain })
end


-- -------------------------
-- ğŸ”¹ RenderStepped ãƒ«ãƒ¼ãƒ— (ãƒ¡ã‚¤ãƒ³å‡¦ç†)
-- -------------------------
RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local camera = Workspace.CurrentCamera

    if not char or not hum or not hrp or not camera then return end

    -- ... (æ—¢å­˜ã®RenderSteppedãƒ­ã‚¸ãƒƒã‚¯ 1~6 ã¯å¤‰æ›´ãªã—) ...

    -- 7. KiLL Grab (Grab & Instant Kill)
    if KiLLGrab then
        if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
            if not forcedTeleportTarget or not forcedTeleportTarget.Parent then
                local target = GetClosestPlayer(GRAB_RANGE)
                if target and target.Character then
                    forcedTeleportTarget = target.Character:FindFirstChild("HumanoidRootPart")
                    if forcedTeleportTarget then
                        forcedTeleportTarget.CFrame = CFrame.new(forcedTeleportTarget.Position.X, KILL_HEIGHT, forcedTeleportTarget.Position.Z)
                        if Rayfield then Rayfield.Notify({Title = "KiLL Grab", Content = "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ãƒ­ãƒƒã‚¯ã—ã€ãƒ†ãƒ¬ãƒãƒ¼ãƒˆé–‹å§‹ã€‚", Duration = 1}) end
                    end
                end
            end
        else
            forcedTeleportTarget = nil
        end

        if forcedTeleportTarget and forcedTeleportTarget.Parent then
            forcedTeleportTarget.CFrame = CFrame.new(
                forcedTeleportTarget.Position.X, 
                KILL_HEIGHT, 
                forcedTeleportTarget.Position.Z
            )
        end
    end
    
    -- ... (Toy Infã®RenderSteppedãƒ­ã‚¸ãƒƒã‚¯ã¯ç„¡åŠ¹åŒ–/ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ) ...
end)

-- -------------------------
-- ğŸ”¹ åˆæœŸåŒ–å‡¦ç†
-- -------------------------
if ToyInfEnabled then startToySpawn() end
